<!DOCTYPE html>

<head>
<script language="javascript" type="text/javascript" src="jquery.js"></script>
<script language="javascript" type="text/javascript" src="spin/spin.min.js"></script>
<script language="javascript" type="text/javascript" src="config/config.js"></script>
<!--<script language="javascript" src='projectplace.js' type='text/javascript'></script>-->
<script type="text/javascript" src="oauth/chrome_ex_oauthsimple.js"></script>
<script type="text/javascript" src="oauth/chrome_ex_oauth.js"></script>

<script language="javascript" src='pp-scripts/projectplace-api-calls.js' type='text/javascript'></script>
<script language="javascript" src='pp-scripts/projectplace-view-controller.js' type='text/javascript'></script>
<script language="javascript" src='pp-scripts/projectplace-me-information.js' type='text/javascript'></script>

 <script id="main-view" type="text/html">
	  	<div class="notifications">{{ Notifications }}</div>
	  	<ul id="other">
		  <li>
	        Projects
	        <p class="descr">See all you Projects, and access your Documents</p>
	      </li>
		  <li>
	        Co-workers
	        <p class="descr">Find your co-workers</p>
	      </li>
	  	</ul>
 </script>


<script language="javascript" type="text/javascript">
	/**
	 * Called from injected.js when the oauth process have been verified.
	 * Only called from https://service.projectplace.com/domBlank.html
	 * 		- Closes the oauth request tab down, and calls the init method to get the data.
	 */
	
	var ViewController = new ProjectplaceViewController();
	
	chrome.extension.onRequest.addListener(function (request, sender, sendResponse) {
        if (request.target) {
            switch (request.target) {
                case "saveOauthCredentials": 
					oauth.getAccessToken(request.oauthToken, request.oauthVerifier,function(){
						chrome.tabs.getSelected(null, function (tab) {
						    chrome.tabs.remove(tab.id);
						});
						ViewController.loadInitialView();
					})
					return;
            }
         }
	});
	
	/**
	 * Set up oauth communication/object
	 */
	var oauth = ChromeExOAuth.initBackgroundPage({
		  'request_url': CONFIG.BASEURL+'/initiate',
		  'authorize_url': CONFIG.BASEURL+'/authorize',
		  'access_url': CONFIG.BASEURL+'/token',
		  'consumer_key': CONFIG.OAUTH.CONSUMERKEY,
		  'consumer_secret': CONFIG.OAUTH.CONSUMERSECRET,
		  'scope': CONFIG.LOCALSTORAGEKEY,
		  'app_name': CONFIG.APPNAME
	});
	

	/**
	 * Called when the initial authorization have been done.
	 * @param {Object} oauthToken
	 * @param {Object} oauthVerifier
	 */
	function onAuthorized(oauthToken, oauthVerifier)
	{
		ViewController.loadInitialView();
	}
	oauth.authorize(onAuthorized);

	var opts = {
	  lines: 12, // The number of lines to draw
	  length: 7, // The length of each line
	  width: 5, // The line thickness
	  radius: 10, // The radius of the inner circle
	  color: '#000', // #rbg or #rrggbb
	  speed: 1, // Rounds per second
	  trail: 100, // Afterglow percentage
	  shadow: true // Whether to render a shadow
	};
	var target = document.getElementById('foo');
	var spinner = new Spinner(opts).spin(target);
	

</script>
</head>
<body id="foo">
</body>
</html>