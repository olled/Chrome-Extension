<!DOCTYPE html>

<html lang="en">
<head>
	<meta charset="utf-8">
	<title>Projectplace for Chrome</title>
	<link rel="stylesheet" href="/bootstrap/bootstrap.min.css">
	<link rel="stylesheet" href="local.css">

	<script language="javascript" type="text/javascript" src="jquery.js"></script>
	<script language="javascript" type="text/javascript" src="icanhaz/icanhaz.min.js"></script>
	<script language="javascript" type="text/javascript" src="spin/spin.min.js"></script>

	<script type="text/javascript" src="oauth/chrome_ex_oauthsimple.js"></script>
	<script type="text/javascript" src="oauth/chrome_ex_oauth.js"></script>

	<script language="javascript" src="pp-scripts/projectplace-api-calls.js" type="text/javascript"></script>
	<script language="javascript" src="pp-scripts/projectplace-view-controller.js" type="text/javascript"></script>
	<script language="javascript" src="pp-scripts/projectplace-me-information.js" type="text/javascript"></script>
	<script language="javascript" src="pp-scripts/projectplace-interface-eventhandler.js" type="text/javascript"></script>
	<script language="javascript" src="pp-scripts/projectplace-utils.js" type="text/javascript"></script>
	
	
	<!--
		mainView: the start view, two coll 
	-->
	<script id="mainView" type="text/html">
		<div class="hero-unit" id="trending">
          <h1>Trending</h1>
		  	<blockquote>
			<p id="trendingPost">{{trendingpost}}.</p>
			<small id="trendingWhoUpdatesDates">{{ trendingwho }} {{nrofupdate}} {{lastdate}}</small>
			</blockquote>
          
		  <ul class="pills small">
			  <li class="{{commentsViewActive}}"><a href="#" onclick="return views.mainView(mainViewConfig.TRENDINGBYCOMMENTS);">By nr of comments</a></li>
			  <li class="{{linksViewActive}}"><a href="#" onclick=" return views.mainView(mainViewConfig.TRENDINGBYLIKES);">By nr of Likes</a></li>
		  </ul>
		  <p><a id="getInvolved" class="btn success big" view="{{view}}" goto="{{conversationId}}" onclick="navigation.go(event);">Get involved &raquo;</a></p>
        </div>
		<hr />
	  	<div class="row">
          {{>fournew}}
        </div>	
	</script>
	
	<!-- Partial via {{>fournew}} -->
	<script id="fournew" class="partial" type="text/html">
		<div class="span6">
			{{conversationsOne}}
			<small>{{conversationsOneWho}}</small>
			<p><a class="btn" href="#">View details &raquo;</a></p>
		</div>
		<div class="span5">
			{{conversationsTwo}}
			<small>{{conversationsTwoWho}}</small>
			<p><a class="btn" href="#">View details &raquo;</a></p>
		</div>
		<div class="span5">
			{{conversationsThree}}
			<small>{{conversationsThreeWho}}</small>
			<p><a class="btn" href="#">View details &raquo;</a></p>
		</div>
	</script>
	
	<!--
		aboutView: Who am I who created this..One coll view. 
	-->
	<script id="aboutView" type="text/html">
	  	<div class="row">
          <div class="span6">
            <h3>This is about me!</h3>
			My name is Olle Dahlstršm, and I created this since I want to be able to browse conversations, documents etc 
			from Projectplace right in my browser.
			I do not want to login, I want it where I am, in my browser.
			
			If you see anything strange that does not work, or would like to give me some feedback(possitiv is more fun 
			the negative) or anything, please contact me @ <a href="mailto: olle.dahlstrom@gmail.com">Olle Dahlstršm @ gmail</a>
          </div>
        </div>
	 </script>
	
	
	<!--
		navigation: the main top navigation
	-->
	<script id="navigation" type="text/html">
		<li class="active"><a href="#">Conversations <span>{{ nrOfUpDates }}</span></a></li>
		<li><a href="#">Projects</a></li>
        <li><a href="#about">About</a></li>
        <li><a href="#contact">Contact</a></li>
	</script>
	
		
	<script language="javascript" type="text/javascript">
		var initialLoad = true;
		clearBadgeText();
	
		var background = chrome.extension.getBackgroundPage();
		var user = background.getViewControll().user;
		
		function _showTrendingObject(view){
			runSpinner.close();
			if (view == 'by-comments') {
				var trendingObject = user.getTrendingConversation();
				var coworker = user.getSpecificCoWorker(trendingObject.posts[0].author_id);
				var lastPost = toLocaleDateString(trendingObject.last_post_time);
				$('#trendingPost').html(trendingObject.posts[0].message);
				$('#trendingWhoUpdatesDates').html(coworker.sort_name + ' || Nr of Comments: '+ (trendingObject.post_count -1) + ' - '+lastPost )
				
				document.getElementById('getInvolved').setAttribute('goto',trendingObject.posts[0].id);
				document.getElementById('getInvolved').setAttribute('view',trendingObject.posts[0].id);
			}
			
			
			
		}
		
		function _displayTrendingCommentsBy(){
			var arrOfFourConversations = user.getTopFourConversationsByDate();
			
			
			/*var trendingObject = user.getTrendingConversation();
			var coworker = user.getSpecificCoWorker(trendingObject.posts[0].author_id);
			trendingObject.posts[0].message
			coworker.sort_name
			'Nr of Comments: '+ (trendingObject.post_count -1)
			var lastPost = toLocaleDateString(trendingObject.last_post_time);
			trendingObject.posts[0].id
			*/
			
			
			var mainConf = {
				trendingpost: '',
				trendingwho: '',
				nrofupdate: '',
				lastdate: '',
				conversationId: '',
				view: mainViewConfig.SINGLECONVERSATION,
				commentsViewActive: 'active',
				linksViewActive: '',
				conversationsOne: arrOfFourConversations[0].posts[0].message,
				conversationsOneWho: user.getSpecificCoWorker(arrOfFourConversations[0].posts[0].author_id).sort_name,
				conversationsTwo : arrOfFourConversations[1].posts[0].message,
				conversationsTwoWho: user.getSpecificCoWorker(arrOfFourConversations[1].posts[0].author_id).sort_name,
				conversationsThree : arrOfFourConversations[2].posts[0].message,
				conversationsThreeWho: user.getSpecificCoWorker(arrOfFourConversations[2].posts[0].author_id).sort_name
			};
			var main = ich.mainView(mainConf)
			$('#content').empty();
			$('#content').append(main);
			runSpinner.run();
			window.setTimeout('_showTrendingObject("by-comments")',2000);
			
		}
		function _displayTrendingLikedBy(){
			var arrOfFourConversations = user.getTopFourConversationsByDate();
			var trendingObject = user.getTrendingConversation();
			
			var coworker = user.getSpecificCoWorker(trendingObject.posts[0].author_id);
			
			var lastPost = toLocaleDateString(trendingObject.last_post_time);
			var likedByNr = 0;
			for (var like in trendingObject.liked_by){
				likedByNr++;
			}
			
			var mainConf = {
				trendingpost: trendingObject.posts[0].message,
				trendingwho: coworker.sort_name,
				nrofupdate: 'Nr of Likes: '+ likedByNr,
				lastdate: lastPost,
				conversationId: trendingObject.posts[0].id,
				view: mainViewConfig.SINGLECONVERSATION,
				commentsViewActive: '',
				linksViewActive: 'active',
				conversationsOne: arrOfFourConversations[0].posts[0].message,
				conversationsOneWho: user.getSpecificCoWorker(arrOfFourConversations[0].posts[0].author_id),
				conversationsTwo : arrOfFourConversations[1].posts[0].message,
				conversationsTwoWho: user.getSpecificCoWorker(arrOfFourConversations[1].posts[0].author_id),
				conversationsThree : arrOfFourConversations[2].posts[0].message,
				conversationsThreeWho: user.getSpecificCoWorker(arrOfFourConversations[2].posts[0].author_id)
			};
			var main = ich.mainView(mainConf);
			$('#content').empty();	
			$('#content').append(main);
		}
		var runSpinner = {
			_spinner: null,
			run: function(){
				
				var opts = {
					lines: 12, // The number of lines to draw
					length: 7, // The length of each line
					width: 2, // The line thickness
					radius: 10, // The radius of the inner circle
					color: '#000', // #rbg or #rrggbb
					speed: 1, // Rounds per second
					trail: 100, // Afterglow percentage
					shadow: true // Whether to render a shadow
				};
				
				var target = document.getElementById('trending');
				runSpinner._spinner = new Spinner(opts).spin(target);
			},
			close: function(){
				runSpinner._spinner.stop();
			}
		}
	
		var views = {
			mainView: function(trendingBy){
				runSpinner.run();
				
				if (trendingBy == mainViewConfig.TRENDINGBYCOMMENTS) {
					var trendingId = user.getTrendingConversationOnCommentsId();
					user.setTrendingConversationObject(trendingId);	
					var unReadItems = user.getNewConversationsCount();					
					
					
					if (!initialLoad) {
						
						$('#nav').empty();
					}
					else{
						initialLoad = false;
					}
					//window.setTimeout('_displayTrendingCommentsBy();', 2500);
					_displayTrendingCommentsBy();
					var navConf = {
						nrOfUpDates: '['+unReadItems+']'
					};
					
					var nav = ich.navigation(navConf);
					$('#nav').append(nav);
					
					return false;
				}
				else if (trendingBy == mainViewConfig.TRENDINGBYLIKES) {
					var trendingId = user.getTrendingConversationOnLikesId();
					user.setTrendingConversationObject(trendingId);	
					
					window.setTimeout('_displayTrendingLikedBy();',2500)
					
					return false;
				}
				
			},
			projectsView: function(){
				
			},
			aboutView: function(){
				
			},
			contactsView: function(){
				
				
			}
			
		}		
		window.onload = function(){
			views.mainView(mainViewConfig.TRENDINGBYCOMMENTS);
		}
	</script>
	

  </head>
  <body>
  	<div class="topbar">
      <div class="topbar-inner">
        <div class="container-fluid">
          <a class="brand" href="#">Chrome for Projectplace</a>
          <ul class="nav" id="nav">
			
          </ul>
        </div>
      </div>
    </div>

    <div class="container">
      <div class="content" id="content">
      </div>

      <footer>
        <p><a href="http://github.com/olled/" target="_blank">Get involved?</a></p>
      </footer>

    </div>
  </body>
</html>