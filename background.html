<!DOCTYPE html>
<head>
<script language="javascript" type="text/javascript" src="jquery.js"></script>
<script language="javascript" type="text/javascript" src="spin/spin.min.js"></script>
<script language="javascript" type="text/javascript" src="config/config.js"></script>

<script type="text/javascript" src="oauth/chrome_ex_oauthsimple.js"></script>
<script type="text/javascript" src="oauth/chrome_ex_oauth.js"></script>

<script language="javascript" src='pp-scripts/projectplace-api-calls.js' type='text/javascript'></script>
<script language="javascript" src='pp-scripts/projectplace-view-controller.js' type='text/javascript'></script>
<script language="javascript" src='pp-scripts/projectplace-me-information.js' type='text/javascript'></script>
<script language="javascript" src="pp-scripts/projectplace-utils.js" type="text/javascript"></script>
<script language="javascript" type="text/javascript">
/*jslint browser: true, indent:4 */
/*global ProjectplaceViewController, chrome, ChromeExOAuth, CONFIG, window, user */
<<<<<<< HEAD
=======

>>>>>>> e8bb9ac20ba418e94bf161290f1b29d608251a03

var ViewController = ProjectplaceViewController;

/**
 * Set up oauth communication/object
 */

var oauth = ChromeExOAuth.initBackgroundPage({
	'request_url': CONFIG.BASEURL + '/initiate',
	'authorize_url': CONFIG.BASEURL + '/authorize',
	'access_url': CONFIG.BASEURL + '/token',
	'consumer_key': CONFIG.OAUTH.CONSUMERKEY,
	'consumer_secret': CONFIG.OAUTH.CONSUMERSECRET,
	'scope': CONFIG.LOCALSTORAGEKEY,
	'app_name': CONFIG.APPNAME
});

/**
<<<<<<< HEAD
* A reference to the interval controller that checks for updates
=======
* A refrence to the interval controller that checks for updates
>>>>>>> e8bb9ac20ba418e94bf161290f1b29d608251a03
*/
var interValController = null;

/**
* Called from injected.js when the oauth process have been verified.
* Only called from https://service.projectplace.com/domBlank.html
*	- Closes the oauth request tab down, and calls the init method to get the data.
*/

chrome.extension.onRequest.addListener(function (request, sender, sendResponse) {
        if (request.target) {
			oauth.getAccessToken(request.oauthToken, request.oauthVerifier, function () {
				chrome.tabs.getSelected(null, function (tab) {
					chrome.tabs.remove(tab.id);
				});
				ViewController.loadDataInitialView();
				
				interValController = window.setInterval('intervalCallForUpdates()', 30000);
			});
			return false;
        }
});




/**
 * Called when the initial authorization have been done.
 * @param {Object} oauthToken
 * @param {Object} oauthVerifier
 */
function onAuthorized(oauthToken, oauthVerifier)
{
	ViewController.loadDataInitialView();
	interValController = window.setInterval('intervalCallForUpdates()', 30000);
}
oauth.authorize(onAuthorized);

/**
 * Return the set ViewController object.
 */
function getViewControll() {
	return ViewController;
}
/**
 * Called on interval to get new conversations 
 */
function intervalCallForUpdates() {
<<<<<<< HEAD
	console.log('...and here comes the update')
=======
>>>>>>> e8bb9ac20ba418e94bf161290f1b29d608251a03
	getViewControll().user.updateConversations();	
}

</script>
<title>background</title>
</head>
<body >
</body>
</html>