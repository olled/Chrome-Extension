<!DOCTYPE html>

<head>
<script language="javascript" type="text/javascript" src="jquery.js"></script>
<script language="javascript" type="text/javascript" src="spin/spin.min.js"></script>
<script language="javascript" type="text/javascript" src="config/config.js"></script>

<script type="text/javascript" src="oauth/chrome_ex_oauthsimple.js"></script>
<script type="text/javascript" src="oauth/chrome_ex_oauth.js"></script>

<script language="javascript" src='pp-scripts/projectplace-api-calls.js' type='text/javascript'></script>
<script language="javascript" src='pp-scripts/projectplace-view-controller.js' type='text/javascript'></script>
<script language="javascript" src='pp-scripts/projectplace-me-information.js' type='text/javascript'></script>
<script language="javascript" src="pp-scripts/projectplace-utils.js" type="text/javascript"></script>
<script language="javascript" type="text/javascript">
/*jslint browser: true, indent:4 */
/*global ProjectplaceViewController, ViewController,  chrome, ChromeExOAuth, CONFIG */


/**
 * Set up oauth communication/object
 */
var oauth = ChromeExOAuth.initBackgroundPage({
	'request_url': CONFIG.BASEURL + '/initiate',
	'authorize_url': CONFIG.BASEURL + '/authorize',
	'access_url': CONFIG.BASEURL + '/token',
	'consumer_key': CONFIG.OAUTH.CONSUMERKEY,
	'consumer_secret': CONFIG.OAUTH.CONSUMERSECRET,
	'scope': CONFIG.LOCALSTORAGEKEY,
	'app_name': CONFIG.APPNAME
});

/**
* Called from injected.js when the oauth process have been verified.
* Only called from https://service.projectplace.com/domBlank.html
*	- Closes the oauth request tab down, and calls the init method to get the data.
*/

chrome.extension.onRequest.addListener(function (request, sender, sendResponse) {
    if (request.target) {
        if (request.target) {
			oauth.getAccessToken(request.oauthToken, request.oauthVerifier, function () {
				chrome.tabs.getSelected(null, function (tab) {
					chrome.tabs.remove(tab.id);
				});
				ViewController.loadDataInitialView();
			});
			return false;
        }
    }
});
	
/**
 * Called when the initial authorization have been done.
 * @param {Object} oauthToken
 * @param {Object} oauthVerifier
 */
function onAuthorized(oauthToken, oauthVerifier)
{
	ViewController.loadDataInitialView();
}
oauth.authorize(onAuthorized);

/**
 * Return the set ViewController object.
 */
function getViewControll() {
	return ViewController;
}

</script>
<title>background</title>
</head>
<body >
</body>
</html>